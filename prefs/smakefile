#
# OpenURL SASC smakefile
#

# OpenURL
TARGET = OpenURL68k
ODIR   = .sascobjs

# Objs
OBJS = $(ODIR)/OpenURL.o $(ODIR)/loc.o $(ODIR)/utils.o $(ODIR)/popport.o $(ODIR)/popph.o\
       $(ODIR)/ftpeditwin.o $(ODIR)/mailereditwin.o $(ODIR)/browsereditwin.o $(ODIR)/applist.o\
       $(ODIR)/win.o $(ODIR)/about.o $(ODIR)/app.o

# Commands
CC 	   = sc
MKDIR  = makedir
COPY   = copy
RM	   = delete >NIL:
FLUSH  = avail flush
FC	   = flexcat
LD     = slink

# Options
CFLAGS = OPTIMIZE OPTSCHEDULE NOOPTSIZE OPTTIME\
OPTINLINE OPTINLOCAL OPTLOOP NOOPTALIAS OPTPEEP\
OPTRDEPTH=5 OPTDEPTH=5 OPTCOMPLEXITY=8\
PARAMS=r NOCHECKABORT NOSTACKCHECK NOSTACKEXTEND STRINGMERGE IDLEN=128\
COMMENTNEST INCLUDEDIR=/include

# Main target
.PHONY: all
all: $(TARGET)

# Build
$(TARGET): $(ODIR) $(OBJS)
	@echo "    LD $@"
	@$(LD) LIB:c.o $(OBJS) TO $(TARGET) LIB LIB:sc.lib lib:amiga.lib lib:debug.lib SC SD ND NOICONS

# Compile
$(OBJS):
	@echo "    CC $<"
	@$(CC) $(CFLAGS) $< OBJNAME=$@

# Make dir
$(ODIR):
	@$(MKDIR) $(ODIR)

# Loc.h
loc.h: OpenURL.cd
	@echo "    FC $<"
	@$(FC) OpenURL.cd loc.h=loc_h.sd

# Abouts
abouts.h: crunch abouts.dat
	@echo "    => Generating about strings..."
	@crunch abouts.dat abouts.h
	@echo "    <= Done"

# crunch
crunch: crunch.c
	@echo "    CC $<"
	@sc $< LINK NOICONS
	-@$(RM) crunch.o crunch.lnk 

# Clean
.PHONY: clean
clean:
	@echo "    => Cleaning all..."
	-@$(RM) $(ODIR)/*.o
	-@$(RM) $(TARGET)
	-@$(RM) crunch
	@echo "    <= Done"

# Help
.PHONY: help
help:
	@echo "Usage: make [target]"
	@echo " target:"
	@echo "   help     display this information"
	@echo "   all      make $(TARGET)"
	@echo "   depend   create the dependencies file"
	@echo "   clean    clean stuff"
	@echo "   dump     create a dump file"
	@echo ""

$(ODIR)/OpenURL.o: OpenURL.c OpenURL.h OpenURL_protos.h loc.h
$(ODIR)/loc.o: loc.c OpenURL.h OpenURL_protos.h loc.h
$(ODIR)/utils.o: utils.c OpenURL.h OpenURL_protos.h
$(ODIR)/popport.o: popport.c OpenURL.h OpenURL_protos.h
$(ODIR)/popph.o: popph.c OpenURL.h OpenURL_protos.h
$(ODIR)/ftpeditwin.o: ftpeditwin.c OpenURL.h OpenURL_protos.h loc.h
$(ODIR)/mailereditwin.o: mailereditwin.c OpenURL.h OpenURL_protos.h loc.h
$(ODIR)/browsereditwin.o: browsereditwin.c OpenURL.h OpenURL_protos.h loc.h
$(ODIR)/applist.o: applist.c OpenURL.h OpenURL_protos.h loc.h
$(ODIR)/win.o: win.c OpenURL.h OpenURL_protos.h loc.h
$(ODIR)/about.o: about.c OpenURL.h OpenURL_protos.h loc.h OpenURL_rev.h
$(ODIR)/app.o: app.c OpenURL.h OpenURL_protos.h loc.h OpenURL_rev.h

