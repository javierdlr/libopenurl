#
# OpenURL SASC smakefile
#

# OpenURL
TARGET = openurl.library68K
ODIR   = .sascobjs

# Objs
OBJS = $(ODIR)/libent.o $(ODIR)/libinit.o $(ODIR)/endcode.o $(ODIR)/init.o $(ODIR)/api.o\
       $(ODIR)/handler.o $(ODIR)/prefs.o $(ODIR)/utils.o

# Commands
CC 	    = sc
MKDIR   = makedir
COPY    = copy
RM	    = delete >NIL:
FLUSH   = avail flush
FC	    = flexcat
LD      = slink
ASM     = a68k
ASMOPTS = -iainc:

# Options
CFLAGS = OPTIMIZE OPTSCHEDULE NOOPTSIZE OPTTIME\
OPTINLINE OPTINLOCAL OPTLOOP NOOPTALIAS OPTPEEP\
OPTRDEPTH=5 OPTDEPTH=5 OPTCOMPLEXITY=8\
PARAMS=r NOCHECKABORT NOSTACKCHECK NOSTACKEXTEND STRINGMERGE IDLEN=128\
COMMENTNEST INCLUDEDIR=/include

# Main target
.PHONY: all
all: $(TARGET)

# Build
$(TARGET): $(ODIR) $(OBJS)
	@echo "    LD $@"
	@$(LD) $(OBJS) TO $(TARGET) LIB LIB:sc.lib lib:amiga.lib lib:debug.lib SC SD ND NOICONS

# Compile
.c.o:
	@echo "    CC $<"
	@$(CC) $(CFLAGS) $< OBJNAME=$@

.asm.o:
	@echo "    ASM $<"
	@$(ASM) $(ASMOPTS) $< -o$@

# Make dir
$(ODIR):
	@$(MKDIR) $(ODIR)

# Clean
.PHONY: clean
clean:
	@echo "    => Cleaning all..."
	-@$(RM) $(ODIR)/*.o
	-@$(RM) $(TARGET)
	-@$(RM) crunch
	@echo "    <= Done"

# Help
.PHONY: help
help:
	@echo "Usage: make [target]"
	@echo " target:"
	@echo "   help     display this information"
	@echo "   all      make $(TARGET)"
	@echo "   depend   create the dependencies file"
	@echo "   clean    clean stuff"
	@echo "   dump     create a dump file"
	@echo ""

$(ODIR)/libent.o: libent.asm openurl.library_rev.i
$(ODIR)/libinit.o: libinit.c lib.h openurl.library_rev.h base.h lib_protos.h
$(ODIR)/endcode.o: endcode.asm
$(ODIR)/init.o: init.c lib.h base.h lib_protos.h
$(ODIR)/api.o: api.c lib.h base.h lib_protos.h openurl.library_rev.h
$(ODIR)/handler.o: handler.c lib.h base.h lib_protos.h
$(ODIR)/prefs.o: prefs.c lib.h base.h lib_protos.h
$(ODIR)/utils.o: utils.c lib.h base.h lib_protos.h
$(ODIR)/morphos.o: morphos.c lib.h base.h lib_protos.h

